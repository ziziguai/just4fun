{include file='ck1sh/_partials/head_inc.html'}
<body>
	<!--顶部警告框-->
	<div class="topWarn"></div>
	<div class="wrap">
		<ul class="breadcrumb" style="background-color: transparent;">
            <li><a href="http://demo.chukou1.cn/Client/Home/Home.aspx">首页</a>&nbsp;<span class="divider">/</span></li>
            <li><a href="?r=oms/home">Selling Helper</a>&nbsp;<span class="divider">/</span></li>
            <li><a href="?r=oms/shorder/normal&platform={$platform}">{$platformName}</a>&nbsp;<span class="divider">/</span></li>
            <li class="active">设置</li>
        </ul>
		<!--基本参数设置--start-->
		<div class="setBox" style="padding:15px;">
			<form id="nosubmit_form" onSubmit="return false;">
				<h3>基本参数设置</h3>
				<div class="setBoxBody">
					<p>
						<span>上传挂号方式：</span>
						<label><input type="radio" name="UPLOAD_TRACKING" value="300" {if $setup.3 eq 300} checked {/if} id="auto">自动上传挂号到Wish</label>
					</p>
					<p>
						<span></span>
						<label><input type="radio" name="UPLOAD_TRACKING" value="301" {if $setup.3 eq 301} checked {/if} id="upload">手动上传</label>
					</p>
					<p>
						<span>SKU：</span>
						<select name="SKU_PRINT" id="Config_SKUSettings" class="input-xlarge">
							<option value="401" {if $setup.4 eq 401} selected{/if} class='CustomLabel'>等于商品编码</option>
							<option value="402" {if $setup.4 eq 402} selected{/if} class='CustomLabel'>是商品编码的一部分（使用分隔符）</option>
							<option value="403" {if $setup.4 eq 403} selected{/if} class='CustomLabel'>是商品编码的一部分（前几位字符）</option>
						</select>
						<b style="color:red" class="help-inline">*</b>
					</p>
					<p id='skupart1' style="display:none;"><span>分隔符号：</span>
			     		<input name="SKU_SEPARATOR" type="text" value="{$setup.5}" maxlength="16">
			     		<b class="help-inline">* 截取第一个分隔符之前的部分</b>
					</p>
					<p id='skupart2' style="display:none;"><span>SKU长度：</span>
				     	<input name="SKU_PREV_LENGTH" type="text" value="{$setup.6}" maxlength="16">
				     	<b class="help-inline">* 截取固定长度的前面部分</b>
				    </p>

					<p class='skuJudge' style="height:20px;text-align:right;font-size:12px;margin:0;padding:0px 45px;display:none"></p>
					<p>
						<span>直发订单自定义标识：</span> 
						<label><input type="radio" name="DIRECT_SHIPMENTS_ORDER_MARK" value = '702' {if $setup.7 eq 702} checked {/if}>订单号</label>
						<label><input type="radio" name="DIRECT_SHIPMENTS_ORDER_MARK" value = '703' {if $setup.7 eq 703} checked {/if}>SKU</label>
						<label><input type="radio" name="DIRECT_SHIPMENTS_ORDER_MARK" value = '704' {if $setup.7 eq 704} checked {/if}>订单号+SKU</label>
						<label><input type="radio" name="DIRECT_SHIPMENTS_ORDER_MARK" value = '707' {if $setup.7 eq 707} checked {/if}>订单号+SKU+Seller</label>
					</p>
					<p>
						<span></span>
						<label><input type="radio" name="DIRECT_SHIPMENTS_ORDER_MARK" value = '705' {if $setup.7 eq 705} checked {/if}>申报名称</label>
						<label><input type="radio" name="DIRECT_SHIPMENTS_ORDER_MARK" value = '706' {if $setup.7 eq 706} checked {/if}>订单号+申报名称</label>
						<label><input type="radio" name="DIRECT_SHIPMENTS_ORDER_MARK" value = '708' {if $setup.7 eq 708} checked {/if}>订单号+申报名称+Seller</label>
					</p>
					<input type="button" name="" value="保存" id="btnSave" class="btn btn-primary">
					<a href="?r=oms/shorder/normal&platform=104">返回上一级</a>

				</div>
			</form>
		</div>
	</div>
	<!-- 基本参数设置--end-->
	{literal}
	<script>
		"use strict";
		require(['util'], function(util){
			// 设置sku的显示
			function showSku(){
				if($("[name=SKU_PRINT]").val()==402){
					$('#skupart1').show();
					$('#skupart2').hide();
					return true;
				}
				if($("[name=SKU_PRINT]").val()==403){
					$('#skupart2').show();
					$('#skupart1').hide();
					return true;
				}
				$('#skupart2,#skupart1').hide();
			}

			// 选择sku选项
			$('#Config_SKUSettings').click(function(){
				showSku();
			});
			showSku();

			var infoChange = 0;	// 信息改变的变量
			// 判断用户是否做了修改
			$("[name=UPLOAD_TRACKING],[name=SKU_PRINT],[name=DIRECT_SHIPMENTS_ORDER_MARK],[name=SKU_SEPARATOR],[name=SKU_PREV_LENGTH]").change(function(){
				infoChange = 1;
			});

			// 保存设置
			$('#btnSave').click(function(){
				if($("[name=SKU_PRINT]").val()==403){
					if(isNaN($("[name=SKU_PREV_LENGTH]").val()) || $("[name=SKU_PREV_LENGTH]").val() == 0 ){
						$("[name=SKU_PREV_LENGTH]").addClass('redBorder');
						util.showTips('error', 'SKU长度必须是数字而且大于0！');
						return;
					}
					$("[name=SKU_PREV_LENGTH]").removeClass('redBorder');
				}
				if($("[name=SKU_PRINT]").val()==402){
					if($("[name=SKU_SEPARATOR]").val() == ''){
						$("[name=SKU_SEPARATOR]").addClass('redBorder');
						util.showTips('error', '分隔符号不能为空！');
						return;
					}
					$("[name=SKU_SEPARATOR]").removeClass('redBorder');
				}
				if(infoChange == 0){
					util.showTips('info', '还没有修改数据，不能保存！');
					return;
				}
				$.ajax({
					type:"POST",
					url:"?r=oms/Shwish/SaveConfig",
					data:$("#nosubmit_form").serialize(),
					success:function(result){
						infoChange = 0;
						if(result.data == 1){
							return util.showTips('success', '修改成功！！！');
						}
						util.showTips('error', '修改失败！！！');
					}
				});
			});

			// 验证输入的截取固定长度的前面部分的数据
			$("[name=SKU_PREV_LENGTH]").on('keyup', function(){
				var num = $(this).val();
				if(isNaN(num)){
					$(this).addClass('redBorder');
					return;
				}
				$(this).removeClass('redBorder');
			});
		});
	</script>
	{/literal}
</body>
</html>
