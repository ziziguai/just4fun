{include file='ck1sh/_partials/head_inc.html'}
<body>
    {literal}
    <style>
        .wrap{padding:20px;}
        .conBox {
            padding: 20px;
            border: 1px solid #ddd;
            margin: 15px;
            border-radius: 8px;
        }
        table {
            border: 1px solid #ddd;
            border-collapse: collapse;
        }
        p button {
            margin-left: 15px;
        }
    </style>
    {/literal}
    <div class="wrap" id="hide">
        <p><a href="javascript:;">首页>></a><font color='#DBDBDB'>更新重复订单 </font>
        </p>
        <div class="conBox">
            <p>上传订单成功！</p>
            <p>含有已导入过的订单，请选择是否更新订单信息</p>
            <table class="table table-striped table-condensed table-hover">
                <thead name="">
                    <tr>
                        <th>
                            <input type="checkbox" id = "selectAll"/>
                        </th>
                        <th>操作</th>
                        <th>交易号</th>
                        <th>ItemId</th>
                        <th>seller</th>
                        <th>buyer</th>
                        <th>buyer email</th>
                        <th>SKU</th>
                        <th>国家</th>
                    </tr>
                </thead>
                <tbody name="">
                    {foreach from=$aliOrderId key=a item=i}
                    <tr data-id='{$i.orderHandle.AliOrderId}'>
                        <td id='{$i.orderHandle.AliOrderId}'>
                            <input type="checkbox" class = "checkBoxSelect" name = "checkbox" id = 'cb'/>
                        </td>
                        <td>更新</td>
                        <td>{$i.orderHandle.AliOrderId}</td>
                        <td>{$i.items.$a.orderItems.productId}</td>
                        <td>{$i.orderHandle.sellerSignerFullname}</td>
                        <td>{$i.orderAddress.BuyerName}</td>
                        <td>{$i.orderAddress.BuyerEmail}</td>
                        <td>{$i.items.$a.orderItems.skuCode}</td>
                        <td>{$i.orderAddress.CountryName}</td>
                    </tr>
                    {/foreach}
                </tbody>
            </table>
            <p>
                <button class="btn btn-primary" id= "UpdateOrder">更新订单</button>
                <a class="btn" href="{$smarty.server.HTTP_REFERER}">返回</a>
            </p>
        </div>
    </div>
    {literal}
    <script>
        "use strict";
        require(['util'], function(util){
            $(function(){
        		// 全选
    			util.checkAllBoxes($('#selectAll'),$(".checkBoxSelect"));
        		$('#UpdateOrder').click(function(){
        			var isChecked = $('#cb').is(":checked");
        			if(!isChecked){
        				util.showTips('warning', '请选择要更新的订单!');
        			}else{
        				var a = getsId($('.conBox table tbody tr input[type=checkbox]:checked'));
        				$.ajax({
        					url:'index.php?r=oms/SHAliExpress/showExcel&order='+a,
        					success:function(data){
        						if(data){
        							if(confirm('更新成功！是否跳转')){
        								location.href = '?r=oms/shorder/normal&platform=102';
        							}
        						}else{
        							util.showTips('error', '更新失败!');
        						}
        					}
        				});
        			}
        		});

        		// 获取复选框值
                function getsId(obj) {
                    // 参数为被勾选的复选框，即带有checked属性的复选框
        			var str_allId = '';
        			var allCheckBox = obj; // 例：$('.address-label table tbody tr input[type=checkbox]:checked');
        			if (allCheckBox.length == 0) {
        				return '';
        			}
        			for (var i = 0;i<allCheckBox.length; i++) {
        				str_allId += allCheckBox.eq(i).parent().parent().attr('data-id') + ','
        			}
        			var nStr_allId = str_allId.substr(0, str_allId.length - 1);
        			return nStr_allId;
        		}
        	});
        });
    </script>
    {/literal}
</body>
</html>